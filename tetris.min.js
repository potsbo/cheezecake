var e=[[[0,0,0,0],[1,1,1,1]],[[0,0,0,0],[0,1,1,0],[0,1,1,0]],[[0,1,1,0],[1,1,0,0]],[[1,1,0,0],[0,1,1,0]],[[1,0,0,0],[1,1,1,0]],[[0,0,1,0],[1,1,1,0]],[[0,1,0,0],[1,1,1,0]]],f="red yellow magenta green blue orange cyan".split(" ");function g(){for(var c=Math.floor(Math.random()*e.length),b=[],a=0;4>a;a++){b[a]=[];for(var d=0;4>d;d++)b[a][d]=0,e[c][a]&&e[c][a][d]&&(b[a][d]=c+1)}return b};for(var h=document.getElementById("field").getContext("2d"),k=3,l=0,m,p=[],q=0,r=0,t=1E3,u=0,v=0;21>v;v++){p[v]=[];for(var w=0;10>w;w++)p[v][w]=0}m=g();x();y();
function x(){h.clearRect(0,0,600,600);h.strokeStyle="black";h.strokeRect(0,0,300,600);for(var c=0;20>c;c++)for(var b=0;10>b;b++)z(b,c,p[c+1][b]);for(c=0;4>c;c++)for(b=0;4>b;b++)z(k+b,l+c-1,m[c][b]);h.font="bold 30px Century Gothic";h.fillStyle="black";h.fillText("LINE",350,100);h.fillText(q,500,100);h.font="bold 30px Century Gothic";h.fillText("SCORE",350,150);h.fillText(r,500,150);h.font="bold 30px Century Gothic";h.fillText("LEVEL",350,200);h.fillText(u,500,200)}
function z(c,b,a){a&&(h.fillStyle=f[a-1],h.fillRect(30*c,30*b,29,29),h.strokeRect(30*c,30*b,29,29))}function y(){A(0,1)?l++:(B(),C(),u=Math.floor(r/1E3),t=1E3-200*u,m=g(),k=3,l=0,A(0,0)||(x(),clearInterval(game),alert("Game Over")));x();setTimeout(function(){y()},t)}function B(){for(var c=0;4>c;c++)for(var b=0;4>b;b++)m[c][b]&&(p[l+c][k+b]=m[c][b])}function A(c,b,a){c=k+c;b=l+b;a=a||m;for(var d=0;4>d;d++)for(var n=0;4>n;n++)if(a[d][n]&&(21<=b+d||0>c+n||10<=c+n||p[b+d][c+n]))return!1;return!0}
document.body.onkeydown=function(c){switch(c.keyCode){case 37:A(-1,0)&&k--;break;case 39:A(1,0)&&k++;break;case 40:A(0,1)&&l++;break;case 38:c=m;var b=[],a;a:{for(a=0;4>a;a++)if(c[a])for(var d=0;4>d;d++)if(0!==c[a][d]){a=c[a][d];break a}a=void 0}if(2>=a)for(a=0;4>a;++a)for(b[a]=[],d=0;4>d;++d)b[a][d]=c[d][-a+3];else for(a=0;4>a;++a)for(b[a]=[],d=0;4>d;++d)b[a][d]=c[d][-a+2];rotated=b;A(0,0,rotated)&&(m=rotated);break;case 32:for(;A(0,1);)l++,r++;B();break;case 80:alert("pause")}x()};
function C(){for(var c=0,b=20;0<=b;b--){for(var a=!0,d=0;10>d;d++)if(0==p[b][d]){a=!1;break}if(a){for(a=b-1;0<=a;a--)for(d=0;10>d;d++)p[a+1][d]=p[a][d];b++;c++;q++}}switch(c){case 1:r+=40;break;case 2:r+=100;break;case 3:r+=300;break;case 4:r+=1200}};
